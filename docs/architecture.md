# アーキテクチャ概要

## 概要

音声文字起こしアプリケーションは、Electronフレームワークを利用したデスクトップアプリケーションです。このアプリケーションは、メインプロセス（Node.js）とレンダラープロセス（React）から構成され、Python言語による音声処理機能を統合しています。

## システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Electron メインプロセス                    │
├─────────────────────────────────────────────────────────────┤
│  • ファイルシステムアクセス                                    │
│  • Pythonプロセス管理                                       │
│  • IPC通信                                                │
│  • モデル管理                                              │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ IPC
                              │
┌─────────────────────────────────────────────────────────────┐
│                  Electron レンダラープロセス                  │
├─────────────────────────────────────────────────────────────┤
│  • React UIコンポーネント                                    │
│  • 進捗可視化                                              │
│  • テキストエディター                                        │
│  • エクスポート機能                                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ 子プロセス
                              │
┌─────────────────────────────────────────────────────────────┐
│                    Python 音声処理                         │
├─────────────────────────────────────────────────────────────┤
│  • Demucs（音声分離）                                       │
│  • faster-whisper（Small/Medium）                         │
│  • OpenAI Whisper（Large-v3-turbo）                      │
│  • 音声フォーマット変換                                      │
└─────────────────────────────────────────────────────────────┘
```

## 技術スタック

- **フロントエンド**: React 18 + TypeScript + Tailwind CSS
- **デスクトップフレームワーク**: Electron 28+
- **音声処理**: Python 3.9+ with Demucs, faster-whisper, openai-whisper
- **プロセス通信**: Node.js child_process + Python subprocess
- **状態管理**: React Context + useState
- **ファイル処理**: Electron's dialog API + Node.js fs

## メインプロセスコンポーネント

### AudioProcessingManager

音声処理の中心的なコンポーネントです。PythonのDemucsとWhisperを使用して、音声分離と文字起こしを行います。

主な機能:
- 音声ファイルの処理
- Demucsによる音声分離
- Whisperモデルによる文字起こし
- 依存関係のチェック

### FileManager

ファイル操作を管理するコンポーネントです。ファイルの選択、メタデータ取得、エクスポート機能を提供します。

主な機能:
- 音声ファイルの選択ダイアログ
- 音声メタデータの取得
- ファイル形式の検証
- 文字起こし結果のエクスポート

### SettingsManager

アプリケーション設定を管理するコンポーネントです。設定の保存と読み込みを行います。

主な機能:
- デフォルトモデルの管理
- 音声分離設定の管理
- 最近使用したファイルの管理
- エクスポート設定の管理

### ExportService

文字起こし結果のエクスポート機能を提供するコンポーネントです。

主な機能:
- テキスト(.txt)形式でのエクスポート
- Word文書(.docx)形式でのエクスポート
- 字幕(.srt)形式でのエクスポート
- ファイル保存ダイアログの表示

### Logger

アプリケーションログを管理するコンポーネントです。エラーや情報のログ記録を行います。

主な機能:
- エラーのログ記録
- 情報メッセージのログ記録
- ファイルへのログ出力
- コンソールへのログ出力

## レンダラープロセスコンポーネント

### App

アプリケーションのメインコンポーネントです。全体のレイアウトと状態管理を行います。

### RecentFiles

最近使用したファイルのリストを表示するコンポーネントです。

### ProgressIndicator

処理進捗を表示するコンポーネントです。現在の処理段階と残り時間を表示します。

### TranscriptionEditor

文字起こし結果を編集するコンポーネントです。テキストの編集、フォーマット機能を提供します。

### ExportOptions

エクスポート形式を選択するコンポーネントです。各形式の説明も表示します。

### ErrorDisplay

エラーメッセージとトラブルシューティング提案を表示するコンポーネントです。

### NotificationProvider

通知を管理するコンポーネントです。成功、エラー、情報通知を表示します。

## Python処理コンポーネント

### check_deps.py

依存関係をチェックするスクリプトです。Pythonバージョン、必要なモジュール、モデルの存在を確認します。

### demucs/separate.py

音声分離を行うスクリプトです。Demucsを使用して音声ファイルからボーカルトラックを抽出します。

### whisper/transcribe.py

文字起こしを行うスクリプトです。faster-whisperとOpenAI Whisperを使用して音声をテキストに変換します。

## データフロー

1. ユーザーが音声ファイルを選択
2. ファイルメタデータを取得してUIに表示
3. ユーザーがモデルと処理オプションを選択
4. 「文字起こしを開始」ボタンをクリック
5. (オプション) Demucsで音声分離を実行
6. 選択したWhisperモデルで文字起こしを実行
7. 文字起こし結果をUIに表示
8. ユーザーが結果を編集（オプション）
9. ユーザーが結果をエクスポート

## エラーハンドリング

- Python処理エラー: 子プロセスの例外キャッチとログ記録
- ファイルシステムエラー: ファイル権限、存在チェック
- モデルエラー: 不足モデルの検出と通知
- ユーザー入力エラー: ファイル形式の検証

## セキュリティ考慮事項

- すべての処理がローカルで実行（オフライン処理）
- 外部サーバーへのデータ送信なし
- 処理後の一時ファイルのクリーンアップ
- 限定的なファイルシステムアクセス